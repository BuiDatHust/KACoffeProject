<%- include('_layouts/header'); -%>
    <div class="responsive-nav" data-toggle="collapse" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
        <p class="breadcrumbs"><span class="mr-2"><a href="/KACoffe/v1">Trang chủ <i
        class="ion-ios-arrow-forward"></i></a></span> <span>Thông tin sản phẩm<i
      class="ion-ios-arrow-forward"></i></span></p>
    </div>
    <section class="hero-wrap hero-wrap-2" style="background-image: url('/images/bg_5.jpg');" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row no-gutters slider-text align-items-center justify-content-center">
                <div class="col-md-9 ftco-animate text-center">
                    <h1 class="mb-2 bread">Sản phẩm</h1>
                    <p class="breadcrumbs"><span class="mr-2"><a href="/KACoffe/v1">Trang chủ <i
              class="ion-ios-arrow-forward"></i></a></span> <span>Thông tin sản phẩm<i
            class="ion-ios-arrow-forward"></i></span></p>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section ftco-no-pt ftco-no-pb">
        <div class="container">
            <div class="row d-flex2">
                <div class="responsive-productdetail ftco-animate img img-2 cart-img-img">
                    <img class="image-0" src="<%= product.Image[0] %>" style="width:100%; margin-bottom: 12px">
                    <img class="image-1" src="<%= product.Image[0] %>" style="width:calc(25% - 10px); margin-right:9px">
                    <img class="image-2" src="<%= product.Image[1] %>" style="width:calc(25% - 10px); margin-right:9px">
                    <img class="image-3" src="<%= product.Image[2] %>" style="width:calc(25% - 10px); margin-right:9px">
                    <img class="image-4" src="<%= product.Image[3] %>" style="width:calc(25% - 10px)">
                </div>

                <div class="col-md-7 ftco-animate makereservation p-4 p-md-5">
                    <div class="heading-section ftco-animate">
                        <span class="subheading">Thông tin sản phẩm</span>
                        <h2 name="product" class="mb-4">
                            <%= product.name %>
                        </h2>

                        <div class="stars-outer">
                            <div class="stars-inner"></div>
                            <span style="margin-left: 2px;" class="number-rating"><%= product.averageRating %></span>
                        </div>

                    </div>
                    <p class="price"><del><span class="woocommerce-Price-amount amount"><%= product.realprice %>&nbsp;<span
              class="woocommerce-Price-currencySymbol">₫</span></span></del> <ins><span
            class="woocommerce-Price-amount amount"><%= product.price %>&nbsp;<span
              class="woocommerce-Price-currencySymbol">₫</span></span></ins></p>
                    <div class="woocommerce-product-details__short-description">
                        <p>
                            <%= product.description %>
                        </p>
                        <p><strong>Nguyên liệu:</strong></p>
                        <p>
                            <%= product.material %>
                        </p>
                        <p><strong>Mô tả sản phẩm:</strong></p>
                        <p style="white-space: pre-line;margin-top: -30px;">
                            <%= product.detaildescription %>
                        </p>

                    </div>
                    <!-- <p>Hình ảnh sản phầm: </p>
                <div>
                    <% product.Image.forEach(function(img){ %>
                        <img src="<%= img  %>" >
                    <% }) %>
                </div> -->
                    <!-- <form class="cart" action="/reservation.html" method="" enctype="multipart/form-data"> -->
                    <% if(user.role=="user" || !user) { %>
                        <div class="quantity p-3" style="border:1px solid #D5E5F5">
                            <form method="POST" action="/KACoffe/v1/order">
                                <input type="hidden" name="product" value="<%= product._id %>">
                                <!-- <input type="number" id="quantity_61968f808d09d" class="input-text qty text" step="1" min="1" max="" name="quantity" value="1" title="Qty" size="4" pattern="[0-9]*" inputmode="numeric" aria-labelledby="Cà phê Hạt Arabica gu đặc biệt gói 250g quantity"> -->
                                Số lượng: <input type="number" id="quantity_61968f808d09d" min="1" class="input-text qty text mr-5" name="quantity" value="1">Chọn kích cỡ:
                                <select name="size">
                                        <option value="S" >S</option>
                                        <option value="M" >M</option>
                                        <option value="L" >L</option>
                                    </select>
                                <input type="submit" onclick="checkQuantity(event)" value="Thêm vào giỏ" class="btn btn-primary py-3 px-5 mt-4">
                            </form>
                        </div>
                        <% }else{ %>
                            <div class="quantity p-3" style="border:1px solid #D5E5F5">
                                <form id="form-buy" method="POST">
                                    <input type="hidden" name="product" value="<%= product._id %>">
                                    <!-- <input type="number" id="quantity_61968f808d09d" class="input-text qty text" step="1" min="1" max="" name="quantity" value="1" title="Qty" size="4" pattern="[0-9]*" inputmode="numeric" aria-labelledby="Cà phê Hạt Arabica gu đặc biệt gói 250g quantity"> -->
                                    Số lượng:
                                    <input type="number" id="quantity_61968f808d09d" min="1" class="input-text qty text mr-5" name="quantity" value="1"> Chọn kích cỡ:
                                    <select name="size">
                                        <option value="S" >S</option>
                                        <option value="M" >M</option>
                                        <option value="L" >L</option>
                                    </select>
                                    </br>
                                    <input id="buy-by-admin" type="submit" value="Đặt tại quán" class="btn btn-primary mt-4 mr-3">
                                    <input id="buy-free" type="submit" value="Đổi chai miễn phí" class="btn btn-primary mt-4">
                                </form>
                                <script>
                                    var formBuy = document.getElementById("form-buy")
                                    var buyByAdmin = document.getElementById("buy-by-admin")
                                    var buyFree = document.getElementById("buy-free")

                                    buyByAdmin.addEventListener('click', async(event) => {
                                        const quantity = document.querySelector('input[name="quantity"]')
                                        if (!quantity.value) {
                                            event.preventDefault()
                                            await swal("Thất bại!", "Bạn chưa nhập số lượng sản phẩm", "warning")
                                        } else {
                                            formBuy.action = "/KACoffe/v1/order"
                                            formBuy.submit()
                                        }
                                    })

                                    buyFree.addEventListener('click', async(event) => {
                                        const quantity = document.querySelector('input[name="quantity"]')
                                        if (!quantity.value) {
                                            event.preventDefault()
                                            await swal("Thất bại!", "Bạn chưa nhập số lượng sản phẩm", "warning")
                                        } else {
                                            formBuy.action = "/KACoffe/v1/order/buyfree"
                                            formBuy.submit()
                                        }
                                    })
                                </script>
                                <!--<br>
                                <form method="POST" action="/KACoffe/v1/order/buyfree" >
                                    <input type="hidden" name="product" value="<%= product._id %>">
                                    <!-- <input type="number" id="quantity_61968f808d09d" class="input-text qty text" step="1" min="1" max="" name="quantity" value="1" title="Qty" size="4" pattern="[0-9]*" inputmode="numeric" aria-labelledby="Cà phê Hạt Arabica gu đặc biệt gói 250g quantity"> 
                                    Số lượng: <input type="number" id="quantity_61968f808d09d" min="1" class="input-text qty text mr-5" name="quantity">Chọn kích cỡ: 
                                    <select name="size" >
                                        <option value="S" >S</option>
                                        <option value="M" >M</option>
                                        <option value="L" >L</option>
                                    </select>
                                      
                                </form>-->
                            </div>
                            <% } %>
                </div>

            </div>
            <div class="p-3 mt-4 mb-4" style="border:1px solid #D5E5F5;display: none;" id="responsive__cart">
                <% if(user.role=="user" || !user) { %>
                    <form method="POST" action="/KACoffe/v1/order">
                        <input type="hidden" name="product" value="<%= product._id %>">
                        <!-- <input type="number" id="quantity_61968f808d09d" class="input-text qty text" step="1" min="1" max="" name="quantity" value="1" title="Qty" size="4" pattern="[0-9]*" inputmode="numeric" aria-labelledby="Cà phê Hạt Arabica gu đặc biệt gói 250g quantity"> -->
                        Số lượng: <input type="number" id="quantity_61968f808d09d" min="1" class="input-text qty text mr-5" name="quantity" value="1">
                        <br>
                        <div class="mt-3 mb-3">
                            Chọn kích cỡ:
                            <select name="size">
                                <option value="S" >S</option>
                                <option value="M" >M</option>
                                <option value="L" >L</option>
                            </select>
                        </div>
                        <input type="submit" value="Thêm vào giỏ" class="btn btn-primary">
                    </form>
                <% } else { %>
                    <form id="form-buy-1" method="POST">
                        <input type="hidden" name="product" value="<%= product._id %>">
                        <!-- <input type="number" id="quantity_61968f808d09d" class="input-text qty text" step="1" min="1" max="" name="quantity" value="1" title="Qty" size="4" pattern="[0-9]*" inputmode="numeric" aria-labelledby="Cà phê Hạt Arabica gu đặc biệt gói 250g quantity"> -->
                        Số lượng:
                        <input type="number" id="quantity_61968f808d09d" min="1" class="input-text qty text" name="quantity" value="1"> 
                        <div class="mt-3 mb-3">
                            Chọn kích cỡ:
                            <select name="size">
                                <option value="S" >S</option>
                                <option value="M" >M</option>
                                <option value="L" >L</option>
                            </select>
                        </div>
                        <input id="buy-by-admin-1" type="button" value="Đặt tại quán" class="btn btn-primary">
                        <input id="buy-free-1" type="button" value="Đổi chai miễn phí" class="btn btn-primary">
                    </form>
                    <script>
                        var formBuy = document.getElementById("form-buy-1")
                        var buyByAdmin = document.getElementById("buy-by-admin-1")
                        var buyFree = document.getElementById("buy-free-1")
    
                        buyByAdmin.addEventListener('click', async(event) => {
                            console.log(111);
                            const quantity = document.querySelector('input[name="quantity"]')
                            if (!quantity.value) {
                                event.preventDefault()
                                await swal("Thất bại!", "Bạn chưa nhập số lượng sản phẩm", "warning")
                            } else {
                                formBuy.action = "/KACoffe/v1/order"
                                formBuy.submit()
                            }
                        })
    
                        buyFree.addEventListener('click', async(event) => {
                            const quantity = document.querySelector('input[name="quantity"]')
                            if (!quantity.value) {
                                event.preventDefault()
                                await swal("Thất bại!", "Bạn chưa nhập số lượng sản phẩm", "warning")
                            } else {
                                formBuy.action = "/KACoffe/v1/order/buyfree"
                                formBuy.submit()
                            }
                        })
                    </script>
                <% } %>
            </div>
            <div class="woocommerce-product-details1__short-description">
                <p>
                    <%= product.description %>
                </p>
                <p><strong>Nguyên liệu:</strong></p>
                <p>
                    <%= product.material %>
                </p>
                <p><strong>Mô tả sản phẩm:</strong></p>
                <p style="white-space: pre-line;margin-top: -30px;">
                    <%= product.detaildescription %>
                </p>

            </div>
            <div class="mt-5">
                <form action="/KACoffe/v1/product/rateProduct/<%= product._id %>" method="POST">
                    <p>Bạn thấy sản phẩm này:
                        <span>
                            <select name="rate">
                                <option value="3">Tốt</option>
                                <option value="4">Rất tốt </option>
                                <option value="5">Tuyệt vời</option>
                                <option value="1">Tệ</option>
                                <option value="2">Tạm được</option>
                            </select>
                        </span>
                        <input type="submit" class="btn btn-primary ml-3" value="Gửi phản hồi" />
                    </p>
                </form>
            </div>
        </div>
    </section>
    <div class="responsive-cart" data-toggle="collapse" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">

        <ul style="height: 100%; display: flex; list-style-type: none !important;padding-left: 0;">
            <li class="responsive-button"><a href="/KACoffe/v1/order/cart" class="nav-link" style="color: #ffffff; padding-top: 0.75rem; display: block;">Xem giỏ hàng</a></li>
            <li class="responsive-button"><a href="#responsive__cart" class="nav-link" style="color: #ffffff; padding-top: 0.75rem; display: block;">Mua hàng</a></li>
            <!--<input type="submit" value="Thêm vào giỏ" class="btn btn-primary py-3 px-5 mt-4" style="width: 50%;margin-left: 50%;">
                <li href="/KACoffe/v1/order/cart" value="Xem giỏ hàng" class="btn btn-primary py-3 px-5 mt-4" style="width: 50%; ">
                    <i style="align-items: center; color: #ffa92d;" class="fa fa-shopping-cart" aria-hidden="true"></i>
                </li> -->


        </ul>



    </div>

    <%- include('comment') ; -%>

        <%- include('_layouts/footer') ; -%>
            <script>
                const image0 = document.querySelector('.image-0')
                const image1 = document.querySelector('.image-1')
                const image2 = document.querySelector('.image-2')
                const image3 = document.querySelector('.image-3')
                const image4 = document.querySelector('.image-4')
                let average = '<%= product.averageRating %>'

                average = (parseInt(average) / 5).toFixed(1)

                image1.onclick = function() {
                    image0.src = image1.src
                }
                image2.onclick = function() {
                    image0.src = image2.src
                }
                image3.onclick = function() {
                    image0.src = image3.src
                }
                image4.onclick = function() {
                    image0.src = image4.src
                }
                document.addEventListener('DOMContentLoaded', async function() {
                    document.querySelector(".stars-inner").style.width = `${average*100}%`
                    if ('<%= warning %>') {
                        await swal("Thất bại!", "<%= warning %>", "warning")
                    }
                })

                const checkQuantity = async(e) => {
                    const quantity = document.querySelector('input[name="quantity"]')
                    if (!quantity.value) {
                        e.preventDefault()
                        await swal("Thất bại!", "Bạn chưa nhập số lượng sản phẩm", "warning")
                    }
                }
            </script>
            <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>